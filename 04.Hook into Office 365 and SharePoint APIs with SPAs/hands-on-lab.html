<!DOCTYPE html><html><head><meta charset="utf-8"><style>body {
  width: 45em;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 30px;
}

@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAYcAA0AAAAACjQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAABMAAAABwAAAAca8vGTk9TLzIAAAFMAAAARAAAAFZG1VHVY21hcAAAAZAAAAA+AAABQgAP9AdjdnQgAAAB0AAAAAQAAAAEACICiGdhc3AAAAHUAAAACAAAAAj//wADZ2x5ZgAAAdwAAADRAAABEKyikaNoZWFkAAACsAAAAC0AAAA2AtXoA2hoZWEAAALgAAAAHAAAACQHngNFaG10eAAAAvwAAAAQAAAAEAwAACJsb2NhAAADDAAAAAoAAAAKALIAVG1heHAAAAMYAAAAHwAAACABEAB2bmFtZQAAAzgAAALBAAAFu3I9x/Nwb3N0AAAF/AAAAB0AAAAvaoFvbwAAAAEAAAAAzBdyYwAAAADP2IQvAAAAAM/bz7t4nGNgZGFgnMDAysDB1Ml0hoGBoR9CM75mMGLkYGBgYmBlZsAKAtJcUxgcPsR8iGF2+O/AEMPsznAYKMwIkgMA5REMOXicY2BgYGaAYBkGRgYQsAHyGMF8FgYFIM0ChED+h5j//yEk/3KoSgZGNgYYk4GRCUgwMaACRoZhDwCs7QgGAAAAIgKIAAAAAf//AAJ4nHWMMQrCQBBF/0zWrCCIKUQsTDCL2EXMohYGSSmorScInsRGL2DOYJe0Ntp7BK+gJ1BxF1stZvjz/v8DRghQzEc4kIgKwiAppcA9LtzKLSkdNhKFY3HF4lK69ExKslx7Xa+vPRVS43G98vG1DnkDMIBUgFN0MDXflU8tbaZOUkXUH0+U27RoRpOIyCKjbMCVejwypzJJG4jIwb43rfl6wbwanocrJm9XFYfskuVC5K/TPyczNU7b84CXcbxks1Un6H6tLH9vf2LRnn8Ax7A5WQAAAHicY2BkYGAA4teL1+yI57f5ysDNwgAC529f0kOmWRiYVgEpDgYmEA8AUzEKsQAAAHicY2BkYGB2+O/AEMPCAAJAkpEBFbAAADgKAe0EAAAiAAAAAAQAAAAEAAAAAAAAKgAqACoAiAAAeJxjYGRgYGBhsGFgYgABEMkFhAwM/xn0QAIAD6YBhwB4nI1Ty07cMBS9QwKlQapQW3VXySvEqDCZGbGaHULiIQ1FKgjWMxknMfLEke2A+IJu+wntrt/QbVf9gG75jK577Lg8K1qQPCfnnnt8fX1NRC/pmjrk/zprC+8D7tBy9DHgBXoWfQ44Av8t4Bj4Z8CLtBL9CniJluPXASf0Lm4CXqFX8Q84dOLnMB17N4c7tBo1AS/Qi+hTwBH4rwHHwN8DXqQ30XXAS7QaLwSc0Gn8NuAVWou/gFmnjLrEaEh9GmDdDGgL3B4JsrRPDU2hTOiMSuJUIdKQQayiAth69r6akSSFqIJuA19TrzCIaY8sIoxyrNIrL//pw7A2iMygkX5vDj+G+kuoLdX4GlGK/8Lnlz6/h9MpmoO9rafrz7ILXEHHaAx95s9lsI7AHNMBWEZHULnfAXwG9/ZqdzLI08iuwRloXE8kfhXYAvE23+23DU3t626rbs8/8adv+9DWknsHp3E17oCf+Z48rvEQNZ78paYM38qfk3v/u3l3u3GXN2Dmvmvpf1Srwk3pB/VSsp512bA/GG5i2WJ7wu430yQ5K3nFGiOqgtmSB5pJVSizwaacmUZzZhXLlZTq8qGGFY2YcSkqbth6aW1tRmlaCFs2016m5qn36SbJrqosG4uMV4aP2PHBmB3tjtmgN2izkGQyLWprekbIntJFing32a5rKWCN/SdSoga45EJykyQ7asZvHQ8PTm6cslIpwyeyjbVltNikc2HTR7YKh9LBl9DADC0U/jLcBZDKrMhUBfQBvXRzLtFtjU9eNHKin0x5InTqb8lNpfKv1s1xHzTXRqgKzek/mb7nB8RZTCDhGEX3kK/8Q75AmUM/eLkfA+0Hi908Kx4eNsMgudg5GLdRD7a84npi+YxNr5i5KIbW5izXas7cHXIMAau1OueZhfj+cOcP3P8MNIWLyYOBuxL6DRylJ4cAAAB4nGNgYoAALjDJyIAOWMCiTIxMLDmZedkABtIBygAAAA==) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .anchor {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  display: block;
  padding-right: 6px;
  padding-left: 30px;
  margin-left: -30px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  display: none;
  color: #000;
  vertical-align: middle;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  height: 1em;
  padding-left: 8px;
  margin-left: -30px;
  line-height: 1;
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  display: inline-block;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body .highlight {
  background: #ffffff;
}

.markdown-body .highlight .c {
  color: #999988;
  font-style: italic;
}

.markdown-body .highlight .err {
  color: #a61717;
  background-color: #e3d2d2;
}

.markdown-body .highlight .k {
  font-weight: bold;
}

.markdown-body .highlight .o {
  font-weight: bold;
}

.markdown-body .highlight .cm {
  color: #999988;
  font-style: italic;
}

.markdown-body .highlight .cp {
  color: #999999;
  font-weight: bold;
}

.markdown-body .highlight .c1 {
  color: #999988;
  font-style: italic;
}

.markdown-body .highlight .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}

.markdown-body .highlight .gd {
  color: #000000;
  background-color: #ffdddd;
}

.markdown-body .highlight .gd .x {
  color: #000000;
  background-color: #ffaaaa;
}

.markdown-body .highlight .ge {
  font-style: italic;
}

.markdown-body .highlight .gr {
  color: #aa0000;
}

.markdown-body .highlight .gh {
  color: #999999;
}

.markdown-body .highlight .gi {
  color: #000000;
  background-color: #ddffdd;
}

.markdown-body .highlight .gi .x {
  color: #000000;
  background-color: #aaffaa;
}

.markdown-body .highlight .go {
  color: #888888;
}

.markdown-body .highlight .gp {
  color: #555555;
}

.markdown-body .highlight .gs {
  font-weight: bold;
}

.markdown-body .highlight .gu {
  color: #800080;
  font-weight: bold;
}

.markdown-body .highlight .gt {
  color: #aa0000;
}

.markdown-body .highlight .kc {
  font-weight: bold;
}

.markdown-body .highlight .kd {
  font-weight: bold;
}

.markdown-body .highlight .kn {
  font-weight: bold;
}

.markdown-body .highlight .kp {
  font-weight: bold;
}

.markdown-body .highlight .kr {
  font-weight: bold;
}

.markdown-body .highlight .kt {
  color: #445588;
  font-weight: bold;
}

.markdown-body .highlight .m {
  color: #009999;
}

.markdown-body .highlight .s {
  color: #dd1144;
}

.markdown-body .highlight .n {
  color: #333333;
}

.markdown-body .highlight .na {
  color: teal;
}

.markdown-body .highlight .nb {
  color: #0086b3;
}

.markdown-body .highlight .nc {
  color: #445588;
  font-weight: bold;
}

.markdown-body .highlight .no {
  color: teal;
}

.markdown-body .highlight .ni {
  color: purple;
}

.markdown-body .highlight .ne {
  color: #990000;
  font-weight: bold;
}

.markdown-body .highlight .nf {
  color: #990000;
  font-weight: bold;
}

.markdown-body .highlight .nn {
  color: #555555;
}

.markdown-body .highlight .nt {
  color: navy;
}

.markdown-body .highlight .nv {
  color: teal;
}

.markdown-body .highlight .ow {
  font-weight: bold;
}

.markdown-body .highlight .w {
  color: #bbbbbb;
}

.markdown-body .highlight .mf {
  color: #009999;
}

.markdown-body .highlight .mh {
  color: #009999;
}

.markdown-body .highlight .mi {
  color: #009999;
}

.markdown-body .highlight .mo {
  color: #009999;
}

.markdown-body .highlight .sb {
  color: #dd1144;
}

.markdown-body .highlight .sc {
  color: #dd1144;
}

.markdown-body .highlight .sd {
  color: #dd1144;
}

.markdown-body .highlight .s2 {
  color: #dd1144;
}

.markdown-body .highlight .se {
  color: #dd1144;
}

.markdown-body .highlight .sh {
  color: #dd1144;
}

.markdown-body .highlight .si {
  color: #dd1144;
}

.markdown-body .highlight .sx {
  color: #dd1144;
}

.markdown-body .highlight .sr {
  color: #009926;
}

.markdown-body .highlight .s1 {
  color: #dd1144;
}

.markdown-body .highlight .ss {
  color: #990073;
}

.markdown-body .highlight .bp {
  color: #999999;
}

.markdown-body .highlight .vc {
  color: teal;
}

.markdown-body .highlight .vg {
  color: teal;
}

.markdown-body .highlight .vi {
  color: teal;
}

.markdown-body .highlight .il {
  color: #009999;
}

.markdown-body .highlight .gc {
  color: #999;
  background-color: #EAF2F5;
}

.markdown-body .octicon {
  font: normal normal 16px octicons-anchor;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}
</style><title>hands-on-lab</title></head><body><article class="markdown-body"><h1 id="module-04---hook-into-office-365-and-sharepoint-with-single-page-apps">
<a name="user-content-module-04---hook-into-office-365-and-sharepoint-with-single-page-apps" class="anchor" href="#module-04---hook-into-office-365-and-sharepoint-with-single-page-apps" aria-hidden="true"><span class="octicon octicon-link"></span></a>Module 04 - Hook into Office 365 and SharePoint with Single Page Apps</h1>

<p>In this lab, configure Apps for Office in Word and Outlook. The lab uses an existing application that can be found in the src folder.</p>

<h2 id="overview">
<a name="user-content-overview" class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h2>

<p>This lab enables students to take an existing ASP.NET application, configure it with an Azure AD app &amp; create a single page application that reads and writes data to SharePoint in Office 365.</p>

<p>This lab uses an existing ASP.NET web application that can be found in the <code>/src/StarterProject</code> folder. To save some time with the coding portion of this lab, empty files have already been added that you will fill in with the code outlined in the steps below.</p>

<blockquote>
<p>If you are interested in seeing an advanced version of the sample project you build in this lab, refer to the <a href="https://github.com/OfficeDev/Research-Project-Code-Sample">Research Project Code Sample</a> project on the <a href="https://github.com/OfficeDev">OfficeDev GitHub</a> account. It adds some extra user interface controls like a busy animation &amp; toast notifications as well as a master-detail implementation to the lab. </p>

<p>These additional pieces would make this lab unnecessarily long and therefore have been omitted form the sample you will build in this lab.</p>
</blockquote>

<h2 id="objectives">
<a name="user-content-objectives" class="anchor" href="#objectives" aria-hidden="true"><span class="octicon octicon-link"></span></a>Objectives</h2>

<ul>
<li>Learn to configure Microsoft Azure AD for an Office 365 app.</li>
<li>Understand how and why you need to secure an OAuth access token.</li>
<li>Create a single page app.</li>
</ul><h2 id="prerequisites">
<a name="user-content-prerequisites" class="anchor" href="#prerequisites" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prerequisites</h2>

<ul>
<li>Visual Studio 2013 for Windows 8</li>
<li>You must have an Office 365 tenant and Windows Azure subscription to complete this lab.</li>
<li>You must have completed the lab associated with Module 2.</li>
</ul><h2 id="exercises">
<a name="user-content-exercises" class="anchor" href="#exercises" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exercises</h2>

<p>The hands-on lab includes the following exercises:</p>

<ul>
<li><a href="#exercise1">Create and configure an Azure AD Application</a></li>
<li><a href="#exercise2">Explore and Configure the Starter Project</a></li>
<li><a href="#exercise3">Build the Single Page App</a></li>
</ul><p><a name="user-content-exercise1" aria-hidden="true"></a></p>

<h2 id="exercise-1-create-and-configure-an-azure-ad-application">
<a name="user-content-exercise-1-create-and-configure-an-azure-ad-application" class="anchor" href="#exercise-1-create-and-configure-an-azure-ad-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exercise 1: Create and configure an Azure AD Application</h2>

<p>In this exercise you will create and configure an Azure AD application that the single page application will leverage.</p>

<h3 id="task-1---create-azure-ad-application">
<a name="user-content-task-1---create-azure-ad-application" class="anchor" href="#task-1---create-azure-ad-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 1 - Create Azure AD Application</h3>

<p>Follow these steps to create the Azure AD application.</p>

<ol>
<li>Log into the <a href="https://manage.windowsazure.com">Azure Management Portal</a> as an administrator of your subscription.</li>
<li>Click <strong>Active Directory</strong>.</li>
<li>Click the Azure Active Directory associated with your subscription.</li>
<li>Click <strong>Applications</strong>.
<a href="img/01.png?raw=true" target="_blank"><img src="img/01.png?raw=true" alt="Figure 1" style="max-width:100%;"></a>
</li>
<li>Click <strong>Add</strong>.</li>
<li>Click <strong>Add an application my organization is developing</strong>.
<a href="img/02.png?raw=true" target="_blank"><img src="img/02.png?raw=true" alt="Figure 2" style="max-width:100%;"></a>
</li>
<li>On the <strong>Tell us about your application</strong> screen, do the following:

<ol>
<li>Set the <strong>Name</strong> to <strong>SpResearchTrackerSPA</strong>. </li>
<li>Set the <strong>Type</strong> to <strong>Web Application and/or Web API</strong>
</li>
<li>Click the <strong>Arrow</strong> at the bottom right of the screen.
<a href="img/03.png?raw=true" target="_blank"><img src="img/03.png?raw=true" alt="Figure 3" style="max-width:100%;"></a>
</li>
</ol>
</li>
<li>On the <strong>App Properties</strong> screen, do the following:

<ol>
<li>Enter <strong>https://localhost:44362/</strong> in the <strong>Sign-On URL</strong> field.</li>
<li>Enter <strong>https://localhost:44362/SpResearchTracker</strong> in the <strong>App ID URI</strong> field.</li>
</ol>
</li>
<li>Click the <strong>Checkmark</strong> at the bottom right of the screen.
<a href="img/04.png?raw=true" target="_blank"><img src="img/04.png?raw=true" alt="Figure 4" style="max-width:100%;"></a>
</li>
</ol><p>Now you have created a new Azure AD app.</p>

<h3 id="task-2---configure-the-azure-ad-application">
<a name="user-content-task-2---configure-the-azure-ad-application" class="anchor" href="#task-2---configure-the-azure-ad-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 2 - Configure the Azure AD Application</h3>

<p>Follow these steps to configure the Azure AD app. It is assumed you are currently on the page for the newly created app, which is where you are taken after creating the app. If you aren't, navigate to it in the Azure Management Portal.</p>

<ol>
<li>Click <strong>Configure</strong>.
 <a href="img/05.png?raw=true" target="_blank"><img src="img/05.png?raw=true" alt="Figure 5" style="max-width:100%;"></a>
</li>
<li>Locate and copy the <strong>Client ID</strong>. <strong>Save</strong> the value for later.
 <a href="img/06.png?raw=true" target="_blank"><img src="img/06.png?raw=true" alt="Figure 6" style="max-width:100%;"></a>
</li>
<li>In the <strong>Keys</strong> section, select <strong>2 Years</strong> for the duration.
 <a href="img/07.png?raw=true" target="_blank"><img src="img/07.png?raw=true" alt="Figure 7" style="max-width:100%;"></a>
</li>
<li>Click the <strong>Save</strong> button in the footer of the page.
 <a href="img/08.png?raw=true" target="_blank"><img src="img/08.png?raw=true" alt="Figure 8" style="max-width:100%;"></a>
</li>
<li>After the settings save, copy the key. <strong>Save</strong> the value for later.
 <a href="img/09.png?raw=true" target="_blank"><img src="img/09.png?raw=true" alt="Figure 9" style="max-width:100%;"></a>
</li>
<li>In the <strong>Reply URL</strong> section, add <strong>https://localhost:44362</strong>
 <a href="img/10.png?raw=true" target="_blank"><img src="img/10.png?raw=true" alt="Figure 10" style="max-width:100%;"></a>
</li>
<li>Click the <strong>Save</strong> button in the footer of the page.
 <a href="img/08.png?raw=true" target="_blank"><img src="img/08.png?raw=true" alt="Figure 11" style="max-width:100%;"></a>
</li>
<li>In the <strong>Permissions to Other Applications</strong> section, do the following:

<ol>
<li>Select <strong>Office 365 SharePoint Online</strong>.</li>
<li>Grant <strong>Create or Delete Items</strong>, <strong>Edit Items</strong>, and <strong>Read Items</strong> permissions.
<a href="img/11.png?raw=true" target="_blank"><img src="img/11.png?raw=true" alt="Figure 12" style="max-width:100%;"></a>
</li>
</ol>
</li>
<li>Click the <strong>Save</strong> button.
 <a href="img/08.png?raw=true" target="_blank"><img src="img/08.png?raw=true" alt="Figure 13" style="max-width:100%;"></a>
</li>
</ol><p>Now you have configured the Azure AD app.</p>

<p><a name="user-content-exercise2" aria-hidden="true"></a></p>

<h2 id="exercise-2-explore-and-configure-the-starter-project">
<a name="user-content-exercise-2-explore-and-configure-the-starter-project" class="anchor" href="#exercise-2-explore-and-configure-the-starter-project" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exercise 2: Explore and Configure the Starter Project</h2>

<p>In this exercise you will explore the existing starter project provided. A starter project is provided in the interest of time.</p>

<p>You may elect to skip the first task in this exercise. It is provided to familiarize yourself with the starter project that you will use for the reminder of this lab.</p>

<h3 id="task-1---explore-the-starter-project">
<a name="user-content-task-1---explore-the-starter-project" class="anchor" href="#task-1---explore-the-starter-project" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 1 - Explore the Starter Project</h3>

<p>In this task you will explore a starter project provided to save you some time. </p>

<blockquote>
<p><em>This starter project is an ASP.NET MVC application that includes all the code necessary to provide a RESTful OData service to for the single page application (SPA).</em></p>

<p><em>The SPA you will create will not communicate with Office 365 directly, rather it will go through this ASP.NET web application. This is done so the Office 365 OAuth2 access token never touches the client; it is retrieved by the ASP.NET application form Azure AD and stores it in a server-side session.</em></p>

<p><em>When the SPA calls the ASP.NET application, it retrieves the access token from the session state and issues an HTTPS request to Office 365's REST API, including the access token in the request.</em></p>
</blockquote>

<ol>
<li>Locate &amp; open the starter solution <strong><a href="/Users/andrewconnell/Repositories/DevCampTraining/04.Hook into Office 365 and SharePoint APIs with SPAs/src/StarterProject/SpAppResearchTracker.sln">SpAppResearchTracker.sln</a></strong> in Visual Studio 2013.</li>
<li>Open the file <strong>App_Start\BundleConfig.cs</strong>. Notice it has a few entries to load the included JavaScript and CSS files that are already part of the project.</li>
<li>Open the file <strong>App_Start\RouteConfig.cs</strong>. This is the MVC routing configuration file. It has only a single route defined to catch all inbound requests. Notice if nothing is specified, it defaults to the <strong>Home</strong> controller and <strong>Index</strong> view.</li>
<li>Open the file <strong>Views\Shared\_Layout.cshtml</strong>. This is the shared MVC view use by the application. There is nothing special about this view at this time... just notice the line <code>@RenderBody()</code> as that is where the main view will be inserted.</li>
<li>
<p>The <strong>Views\Home\Index.cshtml</strong> view does not contain anything important, so you can skip that. However open the controller for this view, <strong>Controllers\HomeController.cs</strong> &amp; jump to the <code>Index()</code> method.</p>

<ul>
<li>This is the first page a user is taken to when navigating to the site.</li>
<li>It pulls some values from the <code>web.config</code> &amp; creates a redirect URL, <code>redirectUri</code>, where the user should be taken to once they have successfully authenticated.</li>
<li>
<p>The <code>OAuthController</code> is then called which is a class provided by the <a href="https://github.com/AzureADSamples">Microsoft Azure AD Samples &amp; Documentation</a> team in project <a href="https://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-UserIdentity-DotNet">WebApp-WebAPI-OAuth2-UserIdentity-DotNet</a>. </p>

<p>The <code>OAuthController.GetAuthorizationUrl()</code> method initiates the authentication process. This takes the user to Azure AD to login. Upon a successful authentication, the user is sent back to the site, specifically the path <strong>/OAuth</strong>.        </p>

<p>This postback form the Azure AD authentication process is handled by the <code>OAuthController.Index()</code> method that will store the provided OAuth2 access token &amp; refresh token in cache (<em>refer to lines <a href="/src/StarterProject/SpResearchTracker/Controllers/OAuthController.cs#L110">110</a> &amp; <a href="/src/StarterProject/SpResearchTracker/Controllers/OAuthController.cs#L117">111</a></em>) for later use.</p>

<p>Finally the user is redirected back to the specified homepage of the site (<em>see <a href="/src/StarterProject/SpResearchTracker/Controllers/OAuthController.cs#L117">line 117</a> in <strong>OAuthController.cs</strong></em>) that was specified at the start of the authentication process (<em>see line <a href="src/StarterProject/SpResearchTracker/Controllers/HomeController.cs#L19">19</a> in the <strong>HomeController.cs</strong></em>).</p>
</li>
</ul>
</li>
<li>After the user authenticates, they are taken to <strong>/Home/SPA</strong> which is rendered in the view <strong>Views\Home\SPA.cshtml</strong>.

<ul>
<li>Notice the code that is obtaining an anti-forgery token from the server when the view is rendered and written to a hidden form variable.</li>
<li>This will be included in the header of every AJAX request by the SPA and is used by the custom OData service to:

<ol>
<li>Validate the user making the request has been authenticated and </li>
<li>Obtain the OAuth access token from the session state that will be included in the request to the Office 365 REST API.</li>
</ol>
</li>
</ul>
</li>
<li>The <strong>Controllers\ProjecsController.cs</strong> handles all OData HTTP calls by the SPA.</li>
<li>It uses the underlying <strong>Models\ProjectsRepository.cs</strong> class to create the HTTP requests that are sent to the Office 365 REST API &amp; include the OAuth2 access token in the header setting <strong>Authorization</strong>.</li>
</ol><p>In this task you opened and explored the starter project. You should also have an understanding how the authentication is setup and how the Office 365 OAuth2 access token obtained by the ASP.NET application is protected by never exposing it to the client and exclusively keeping it server-side.</p>

<h3 id="task-2---configure-the-starter-project-for-the-azure-ad-application">
<a name="user-content-task-2---configure-the-starter-project-for-the-azure-ad-application" class="anchor" href="#task-2---configure-the-starter-project-for-the-azure-ad-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 2 - Configure the Starter Project for the Azure AD Application</h3>

<p>In this task you will configure the starter project to use the Azure AD application created in the <a href="#exercise1">first exercise</a>.</p>

<ol>
<li>Locate &amp; open the starter solution <strong><a href="/Users/andrewconnell/Repositories/DevCampTraining/04.Hook into Office 365 and SharePoint APIs with SPAs/src/StarterProject/SpAppResearchTracker.sln">SpAppResearchTracker.sln</a></strong> in Visual Studio 2013.</li>
<li>Open the <strong>web.config</strong> file.

<ul>
<li>
<strong>Replace</strong> the <strong>[[REPLACE]]</strong> in the <strong>ida:FederationMetadataLocation</strong> setting with your Office 365 tenant ID.</li>
<li>
<strong>Replace</strong> the <strong>ida:Realm</strong> setting with <strong>APP ID URL</strong> value you entered when creating the Azure AD app: <strong>https://localhost:44362/SpResearchTracker</strong>.</li>
<li>
<strong>Replace</strong> the <strong>ida:AudienceUri</strong> setting with same value you used in the <strong>ida:Realm</strong> setting.</li>
<li>
<strong>Replace</strong> the <strong>ida:Audience</strong> setting with same value you used in the <strong>ida:Realm</strong> setting.</li>
<li>
<strong>Replace</strong> the <strong>ida:Tenant</strong> setting with the appropriate value for your Office 365 environment.</li>
<li>
<strong>Replace</strong> the <strong>ida:ClientID</strong> setting with the value you saved earlier when creating the Azure AD application.</li>
<li>
<strong>Replace</strong> the <strong>ida:AppKey</strong> setting with the value you saved earlier when creating the Azure AD application.</li>
<li>
<strong>Replace</strong> the <strong>ida:Password</strong> setting with the same value you used in the <strong>ida:AppKey</strong> setting.</li>
<li>
<strong>Replace</strong> the <strong>ida:Resource</strong> setting with the appropriate value for your environment (your Office 365 tenant ID).</li>
<li>
<strong>Replace</strong> the <strong>ida:SiteUrl</strong> setting with the value of a SharePoint site collection in your Office 365 subscription.

<ul>
<li>Make sure you have permissions to create lists within the site you specify.</li>
<li>Make sure you <strong>include</strong> a trailing <strong>/</strong> in the URL.</li>
</ul>
</li>
<li>Locate the <code>&lt;system.identityModel&gt;</code> node. Within this node you will find another node, <code>&lt;audienceUris&gt;</code>.

<ul>
<li>
<strong>Replace</strong> the <code>value</code> attribute on the <code>&lt;add&gt;</code> element to the same URL for the SharePoint site you entered for the <strong>ida:SiteUrl</strong> setting above.</li>
</ul>
</li>
<li>Locate the <code>&lt;system.identityModel.services&gt;</code> node. Within this node you will find another node, <code>&lt;wsFederation&gt;</code>

<ul>
<li>
<strong>Replace</strong> the <strong>[[REPLACE]]</strong> in the <code>issuer</code> attribute with your Office 365 tenant ID.</li>
<li>
<strong>Replace</strong> the <strong>[[REPLACE]]</strong> in the <code>realm</code> attribute with same value you used in the <strong>ida:Realm</strong> setting above.</li>
</ul>
</li>
</ul>
</li>
</ol><blockquote>
<p>It may seem strange that you have to enter the same value a few times for different settings. This is because there are different 3rd party libraries that are used in the project that look for the same information using different settings values.</p>
</blockquote>

<p>In this task you configured the starter project to use the Azure AD application created in the <a href="#exercise1">first exercise</a>. </p>

<p><a name="user-content-exercise3" aria-hidden="true"></a></p>

<h2 id="exercise-3-build-the-single-page-app">
<a name="user-content-exercise-3-build-the-single-page-app" class="anchor" href="#exercise-3-build-the-single-page-app" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exercise 3: Build the Single Page App</h2>

<p>In this exercise you will finish the starter project to implement the single page application.</p>

<h3 id="task-1---add-necessary-nuget-packages">
<a name="user-content-task-1---add-necessary-nuget-packages" class="anchor" href="#task-1---add-necessary-nuget-packages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 1 - Add Necessary NuGet Packages</h3>

<p>In this task you will add a series of NuGet packages to the project that will provide the necessary libraries to create a single page application with <a href="https://angularjs.org">AngularJS</a> as well as other dependencies.</p>

<blockquote>
<p>You will use the NuGet Package Manager Console to manually add packages with specific version numbers. Usually you can omit the version number and get the current version, but to ensure no new package versions break this lab, you will use the specific versions used in creating this lab.</p>

<p>This task assumes you still have the <strong><a href="/Users/andrewconnell/Repositories/DevCampTraining/04.Hook into Office 365 and SharePoint APIs with SPAs/src/StarterProject/SpAppResearchTracker.sln">SpAppResearchTracker.sln</a></strong> solution open in Visual Studio 2013 from the last task. If you don't, open it now.</p>
</blockquote>

<ol>
<li><p>In Visual Studio, use the menu to open the NuGet Package Manager Console: <strong>Tools &gt; NuGet Package Manager &gt; Package Manager Console</strong>.</p></li>
<li><p>The Package Manager Console will have a yellow status alert indicating some packages are missing. Click the <strong>Restore</strong> button on the right-hand side of the status message to download all the missing packages that are currently referenced in the solution.</p></li>
<li>
<p>Enter the following into the Package Manager Console to add <strong>AngularJS.Core</strong>:</p>

<div class="highlight highlight-powershell"><pre><span class="n">PM</span><span class="p">&gt;</span> <span class="n">Install-Package</span> <span class="n">-Id</span> <span class="s2">"AngularJS.Core"</span> <span class="n">-Version</span> <span class="n">1</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">16</span>
</pre></div>
</li>
<li>
<p>Enter the following into the Package Manager Console to add <strong>AngularJS.Route</strong>:</p>

<div class="highlight highlight-powershell"><pre><span class="n">PM</span><span class="p">&gt;</span> <span class="n">Install-Package</span> <span class="n">-Id</span> <span class="s2">"AngularJS.Route"</span> <span class="n">-Version</span> <span class="n">1</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">16</span>
</pre></div>
</li>
<li>
<p>Enter the following into the Package Manager Console to add <strong>AngularJS.Sanitize</strong>:</p>

<div class="highlight highlight-powershell"><pre><span class="n">PM</span><span class="p">&gt;</span> <span class="n">Install-Package</span> <span class="n">-Id</span> <span class="s2">"AngularJS.Sanitize"</span> <span class="n">-Version</span> <span class="n">1</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">16</span>
</pre></div>
</li>
<li>
<p>Enter the following into the Package Manager Console to add <strong>AngularJS.Animate</strong>:</p>

<div class="highlight highlight-powershell"><pre><span class="n">PM</span><span class="p">&gt;</span> <span class="n">Install-Package</span> <span class="n">-Id</span> <span class="s2">"AngularJS.Animate"</span> <span class="n">-Version</span> <span class="n">1</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">16</span>
</pre></div>
</li>
<li>
<p>Enter the following into the Package Manager Console to add <strong>bootstrap</strong>:</p>

<div class="highlight highlight-powershell"><pre><span class="n">PM</span><span class="p">&gt;</span> <span class="n">Install-Package</span> <span class="n">-Id</span> <span class="s2">"bootstrap"</span> <span class="n">-Version</span> <span class="n">3</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">0</span>
</pre></div>
</li>
<li>
<p>Enter the following into the Package Manager Console to add <strong>Angular.UI.Bootstrap</strong>:</p>

<div class="highlight highlight-powershell"><pre><span class="n">PM</span><span class="p">&gt;</span> <span class="n">Install-Package</span> <span class="n">-Id</span> <span class="s2">"Angular.UI.Bootstrap"</span> <span class="n">-Version</span> <span class="n">0</span><span class="p">.</span><span class="n">11</span><span class="p">.</span><span class="n">0</span>
</pre></div>
</li>
<li>
<p>Enter the following into the Package Manager Console to add <strong>Breeze.Angular</strong>:</p>

<div class="highlight highlight-powershell"><pre><span class="n">PM</span><span class="p">&gt;</span> <span class="n">Install-Package</span> <span class="n">-Id</span> <span class="s2">"Breeze.Angular"</span> <span class="n">-Version</span> <span class="n">0</span><span class="p">.</span><span class="n">8</span><span class="p">.</span><span class="n">7</span>
</pre></div>
</li>
<li>
<p>Enter the following into the Package Manager Console to add <strong>Breeze.EdmBuilder</strong>:</p>

<div class="highlight highlight-powershell"><pre><span class="n">PM</span><span class="p">&gt;</span> <span class="n">Install-Package</span> <span class="n">-Id</span> <span class="s2">"Breeze.EdmBuilder"</span> <span class="n">-Version</span> <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">5</span>
</pre></div>
</li>
</ol><p>In this task you added all the necessary NuGet packages to the project that you will use in the building of the SPA.</p>

<h3 id="task-2---add-references-to-javascript-amp-css-libraries">
<a name="user-content-task-2---add-references-to-javascript--css-libraries" class="anchor" href="#task-2---add-references-to-javascript--css-libraries" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 2 - Add References to JavaScript &amp; CSS Libraries</h3>

<p>In this task you will update the starter project to include references to all the JavaScript and CSS files added in the NuGet packages.</p>

<blockquote>
<p>This task assumes you still have the <strong><a href="/Users/andrewconnell/Repositories/DevCampTraining/04.Hook into Office 365 and SharePoint APIs with SPAs/src/StarterProject/SpAppResearchTracker.sln">SpAppResearchTracker.sln</a></strong> solution open in Visual Studio 2013 from the last task. If you don't, open it now.</p>
</blockquote>

<ol>
<li>Open the <strong>App_Start\BundleConfig.cs</strong> file.</li>
<li>
<p>Locate the existing <code>StyleBundle</code> named <strong>~/Content/css" in the **App_Start\BundleConfig.cs</strong> file &amp; replace it with the following code:</p>

<div class="highlight highlight-csharp"><pre><span class="n">bundles</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">StyleBundle</span><span class="p">(</span><span class="s">"~/Content/css"</span><span class="p">).</span><span class="n">Include</span><span class="p">(</span>
        <span class="s">"~/Content/bootstrap.css"</span><span class="p">,</span>
        <span class="s">"~/Content/bootstrap-theme.css"</span><span class="p">,</span>
        <span class="s">"~/Content/site.css"</span><span class="p">,</span>
        <span class="s">"~/Content/animation.css"</span><span class="p">));</span>
</pre></div>
</li>
<li>
<p>Now, add the following code to the <strong>App_Start\BundleConfig.cs</strong> file to create a few more bundles. Refer to the comments in the code for an explanation on each one:</p>

<div class="highlight highlight-csharp"><pre><span class="c1">// bootstrap related libraries (form NuGet packages)</span>
<span class="n">bundles</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">ScriptBundle</span><span class="p">(</span><span class="s">"~/bundles/bootstrap"</span><span class="p">).</span><span class="n">Include</span><span class="p">(</span>
        <span class="s">"~/Scripts/bootstrap.js"</span><span class="p">,</span>
        <span class="s">"~/Scripts/respond.js"</span><span class="p">));</span>

<span class="c1">// angular bundle (from NuGet packages)</span>
<span class="n">bundles</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">ScriptBundle</span><span class="p">(</span><span class="s">"~/bundles/angular"</span><span class="p">).</span><span class="n">Include</span><span class="p">(</span>
        <span class="s">"~/Scripts/angular.js"</span><span class="p">,</span>
        <span class="s">"~/Scripts/angular-route.js"</span><span class="p">,</span>
        <span class="s">"~/Scripts/angular-sanitize.js"</span><span class="p">,</span>
        <span class="s">"~/Scripts/angular-animate.js"</span><span class="p">,</span>
        <span class="s">"~/Scripts/angular-ui/ui-bootstrap-tpls.js"</span><span class="p">));</span>

<span class="c1">// breeze bundle (form NuGet packages)</span>
<span class="n">bundles</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">ScriptBundle</span><span class="p">(</span><span class="s">"~/bundles/breeze"</span><span class="p">).</span><span class="n">Include</span><span class="p">(</span>
        <span class="s">"~/Scripts/datajs-1.1.3.js"</span><span class="p">,</span>
        <span class="s">"~/Scripts/q.js"</span><span class="p">,</span>
        <span class="s">"~/Scripts/breeze.debug.js"</span><span class="p">,</span>
        <span class="s">"~/Scripts/breeze.angular.js"</span><span class="p">));</span>

<span class="c1">// spa bootstrapping bundle (empty JS files to be coded)</span>
<span class="n">bundles</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">ScriptBundle</span><span class="p">(</span><span class="s">"~/bundles/appcore"</span><span class="p">).</span><span class="n">Include</span><span class="p">(</span>
        <span class="s">"~/App/app.js"</span><span class="p">,</span>
        <span class="s">"~/App/config.js"</span><span class="p">,</span>
        <span class="s">"~/App/config.route.js"</span><span class="p">,</span>
        <span class="s">"~/App/config.angular.js"</span><span class="p">,</span>
        <span class="s">"~/App/config.breeze.js"</span><span class="p">));</span>

<span class="c1">// spa common modules (empty JS files to be coded)</span>
<span class="n">bundles</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">ScriptBundle</span><span class="p">(</span><span class="s">"~/bundles/appcommonmodules"</span><span class="p">).</span><span class="n">Include</span><span class="p">(</span>
        <span class="s">"~/App/common/common.js"</span><span class="p">));</span>

<span class="c1">// spa controllers (empty JS files to be coded)</span>
<span class="n">bundles</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">ScriptBundle</span><span class="p">(</span><span class="s">"~/bundles/appcontrollers"</span><span class="p">).</span><span class="n">Include</span><span class="p">(</span>
        <span class="s">"~/App/dashboard/dashboard.js"</span><span class="p">,</span>
        <span class="s">"~/App/layout/shell.js"</span><span class="p">,</span>
        <span class="s">"~/App/projects/list.js"</span><span class="p">,</span>
        <span class="s">"~/App/projects/detailView.js"</span><span class="p">,</span> 
        <span class="s">"~/App/projects/detailEdit.js"</span><span class="p">));</span>

<span class="c1">// spa services (empty JS files to be coded)</span>
<span class="n">bundles</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">ScriptBundle</span><span class="p">(</span><span class="s">"~/bundles/appservices"</span><span class="p">).</span><span class="n">Include</span><span class="p">(</span>
        <span class="s">"~/App/services/datacontext.angular.js"</span><span class="p">,</span>
        <span class="s">"~/App/services/datacontext.breeze.js"</span><span class="p">));</span>
</pre></div>

<p>Save your changes and close the <strong>App_Start\BundleConfig.cs</strong> file.</p>
</li>
<li>Open the <strong>Views\Shared\_Layout.cshtml</strong> file.</li>
<li>
<p>Before the closing <code>&lt;/head&gt;</code> tag, add the following code to the <strong>Views\Shared\_Layout.cshtml</strong> file to include all the new <code>ScriptBundles</code> defined in the last step:</p>

<div class="highlight highlight-csharp"><pre><span class="err">@</span><span class="p">*</span> <span class="n">angular</span> <span class="n">modules</span> <span class="p">*</span><span class="err">@</span>
<span class="n">@Scripts</span><span class="p">.</span><span class="n">Render</span><span class="p">(</span><span class="s">"~/bundles/angular"</span><span class="p">)</span>
<span class="err">@</span><span class="p">*</span> <span class="n">breeze</span> <span class="n">libraries</span> <span class="p">*</span><span class="err">@</span>
<span class="n">@Scripts</span><span class="p">.</span><span class="n">Render</span><span class="p">(</span><span class="s">"~/bundles/breeze"</span><span class="p">)</span>
<span class="err">@</span><span class="p">*</span> <span class="n">custom</span> <span class="n">app</span> <span class="n">modules</span><span class="p">,</span> <span class="n">services</span> <span class="n">and</span> <span class="n">utilities</span> <span class="p">*</span><span class="err">@</span>
<span class="n">@Scripts</span><span class="p">.</span><span class="n">Render</span><span class="p">(</span><span class="s">"~/bundles/appcore"</span><span class="p">)</span>
<span class="n">@Scripts</span><span class="p">.</span><span class="n">Render</span><span class="p">(</span><span class="s">"~/bundles/appcommonmodules"</span><span class="p">)</span>
<span class="n">@Scripts</span><span class="p">.</span><span class="n">Render</span><span class="p">(</span><span class="s">"~/bundles/appcontrollers"</span><span class="p">)</span>
<span class="n">@Scripts</span><span class="p">.</span><span class="n">Render</span><span class="p">(</span><span class="s">"~/bundles/appservices"</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>Locate the closing <code>&lt;/html&gt;</code> tag and add the following to include the bootstrap bundle to the the <strong>Views\Shared\_Layout.cshtml</strong> file;</p>

<div class="highlight highlight-csharp"><pre><span class="n">@Scripts</span><span class="p">.</span><span class="n">Render</span><span class="p">(</span><span class="s">"~/bundles/bootstrap"</span><span class="p">)</span>
</pre></div>

<p>Save your changes and close the <strong>Views\Shared\_Layout.cshtml</strong> file.</p>
</li>
</ol><p>In this task you updated the starter project to include references to all the JavaScript and CSS files added in the NuGet packages.</p>

<h3 id="task-3---code-the-single-page-application">
<a name="user-content-task-3---code-the-single-page-application" class="anchor" href="#task-3---code-the-single-page-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 3 - Code the Single Page Application</h3>

<p>In this task you will add code to existing JavaScript and HTML files to implement the single page application (SPA).</p>

<blockquote>
<p>This task assumes you still have the <strong><a href="/Users/andrewconnell/Repositories/DevCampTraining/04.Hook into Office 365 and SharePoint APIs with SPAs/src/StarterProject/SpAppResearchTracker.sln">SpAppResearchTracker.sln</a></strong> solution open in Visual Studio 2013 from the last task. If you don't, open it now.</p>
</blockquote>

<ol>
<li>
<p>First update the shared MVC layout to initialize and bind the AngularJS app to the page.</p>

<ol>
<li>Open the <strong>Views\Shared\_Layout.cshtml</strong> file.</li>
<li>
<p>Add an Angular <strong>app</strong> directive to the opening <code>&lt;html&gt;</code> element:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;html</span> <span class="na">data-ng-app=</span><span class="s">"app"</span><span class="nt">&gt;</span>
</pre></div>
</li>
<li>
<p>Next, make the page title dynamic by adding an Angular <strong>bind</strong> directive to the page's <code>&lt;title&gt;</code> element:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;title</span> <span class="na">data-ng-bind=</span><span class="s">"'Project Research Tracker' + pageTitle"</span><span class="nt">&gt;&lt;/title&gt;</span>
</pre></div>
</li>
</ol>
<p>Save your changes and close the <strong>Views\Shared\_Layout.cshtml</strong> file.</p>
</li>
<li>
<p>Create the Angular module that will serve as the single page application.</p>

<ol>
<li>Open the <strong>App\app.js</strong> file.</li>
<li>
<p>Add the following code to the body of the JavaScript self-executing function: </p>

<div class="highlight highlight-javascript"><pre><span class="c1">// create the app</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// ootb angular modules</span>
    <span class="s1">'ngRoute'</span><span class="p">,</span>      <span class="c1">// app routing support</span>
    <span class="s1">'ngSanitize'</span><span class="p">,</span>   <span class="c1">// fixes html issues with some data binding</span>
    <span class="s1">'ngAnimate'</span><span class="p">,</span>    <span class="c1">// adds animation capabilities</span>

    <span class="s1">'ui.bootstrap'</span><span class="p">,</span>

    <span class="c1">// breeze modules</span>
    <span class="s1">'breeze.angular'</span><span class="p">,</span>     <span class="c1">// wires up breeze with angular automatically</span>

    <span class="c1">// app modules</span>
    <span class="s1">'common'</span>
<span class="p">]);</span>

<span class="c1">// startup code - this runs before the app actually "starts"</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">run</span><span class="p">([</span><span class="s1">'$route'</span><span class="p">,</span> <span class="s1">'breeze.config'</span><span class="p">,</span> <span class="nx">appStartup</span><span class="p">]);</span>
<span class="kd">function</span> <span class="nx">appStartup</span><span class="p">(</span><span class="nx">$route</span><span class="p">,</span> <span class="nx">breezeConfig</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $route - routes are loaded first</span>
    <span class="c1">// $breezeConfig - breeze global configuration module... triggers</span>
    <span class="c1">//    the initial load of the metadata from the WebAPI OData feed</span>
    <span class="c1">//    used throughout the app</span>
<span class="p">}</span>
</pre></div>
</li>
</ol>
<p>Save your changes and close the <strong>App\app.js</strong> file.</p>
</li>
<li>
<p>You referenced two JavaScript modules in the above code that are not yet created: <strong>common</strong> &amp; <strong>breeze.config</strong>. Let's address those now:</p>

<ol>
<li>Open the <strong>App\common\common.js</strong> file.</li>
<li>
<p>Add the following code to the body of the JavaScript self-executing function:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// create module</span>
<span class="kd">var</span> <span class="nx">commonModule</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'common'</span><span class="p">,</span> <span class="p">[]);</span>
<span class="c1">// create provider</span>
<span class="nx">commonModule</span><span class="p">.</span><span class="nx">provider</span><span class="p">(</span><span class="s1">'commonConfig'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">config</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">});</span>
<span class="c1">// create the common service</span>
<span class="nx">commonModule</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">'common'</span><span class="p">,</span>
  <span class="p">[</span><span class="s1">'$window'</span><span class="p">,</span> <span class="s1">'$q'</span><span class="p">,</span> <span class="s1">'$rootScope'</span><span class="p">,</span> <span class="s1">'$timeout'</span><span class="p">,</span> <span class="s1">'commonConfig'</span><span class="p">,</span> <span class="nx">common</span><span class="p">]);</span>
<span class="c1">// create the factory 'common'</span>
<span class="kd">function</span> <span class="nx">common</span><span class="p">(</span><span class="nx">$window</span><span class="p">,</span> <span class="nx">$q</span><span class="p">,</span> <span class="nx">$rootScope</span><span class="p">,</span> <span class="nx">$timeout</span><span class="p">,</span> <span class="nx">commonConfig</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// public signature of module</span>
  <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// pass though common angular dependencies</span>
    <span class="nx">$broadcast</span><span class="o">:</span> <span class="nx">$broadcast</span><span class="p">,</span>
    <span class="nx">$q</span><span class="o">:</span> <span class="nx">$q</span><span class="p">,</span>
    <span class="nx">$timeout</span><span class="o">:</span> <span class="nx">$timeout</span><span class="p">,</span>
    <span class="c1">// my services</span>
    <span class="nx">activateController</span><span class="o">:</span> <span class="nx">activateController</span><span class="p">,</span>
    <span class="c1">// global util functions</span>
    <span class="nx">goBack</span><span class="o">:</span> <span class="nx">goBack</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="nx">service</span><span class="p">;</span>
  <span class="c1">// pass through of the angular $broadcast service</span>
  <span class="kd">function</span> <span class="nx">$broadcast</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$broadcast</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">$rootScope</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// global function used to activate a controller once all promises have completed</span>
  <span class="kd">function</span> <span class="nx">activateController</span><span class="p">(</span><span class="nx">promises</span><span class="p">,</span> <span class="nx">controllerId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$q</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">promises</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">controllerId</span><span class="o">:</span> <span class="nx">controllerId</span> <span class="p">};</span>
      <span class="nx">$broadcast</span><span class="p">(</span><span class="nx">commonConfig</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">controllerActivateSuccessEvent</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// navigate backwards in the history stack</span>
  <span class="kd">function</span> <span class="nx">goBack</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Save your changes and close the <strong>App\common\common.js</strong> file.</p>
</li>
<li><p>Open the <strong>App\config.breeze.js</strong> file. The SPA will leverage the JavaScript library <a href="http://www.breezejs.com">BreezeJS</a> to simplify REST queries.</p></li>
<li>
<p>Add the following code to the body of the JavaScript self-executing function:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// define service</span>
<span class="kd">var</span> <span class="nx">serviceId</span> <span class="o">=</span> <span class="s1">'breeze.config'</span><span class="p">;</span>
<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">).</span><span class="nx">factory</span><span class="p">(</span><span class="nx">serviceId</span><span class="p">,</span>
  <span class="p">[</span><span class="s1">'$q'</span><span class="p">,</span> <span class="s1">'breeze'</span><span class="p">,</span> <span class="nx">configBreeze</span><span class="p">]);</span>
<span class="c1">// create service</span>
<span class="kd">function</span> <span class="nx">configBreeze</span><span class="p">(</span><span class="nx">$q</span><span class="p">,</span> <span class="nx">breeze</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// breeze's entity manager, the 'center of gravity' for all </span>
  <span class="c1">// breeze communication this will be shared across all modules</span>
  <span class="kd">var</span> <span class="nx">entityManager</span><span class="p">;</span>
  <span class="c1">// init service</span>
  <span class="nx">init</span><span class="p">();</span>
  <span class="c1">// service public signature</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">entityManager</span><span class="o">:</span> <span class="nx">entityManager</span><span class="p">,</span>
    <span class="nx">dataService</span><span class="o">:</span> <span class="nx">getDataService</span><span class="p">()</span>
  <span class="p">};</span>
  <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// configure breeze to use WebAPIOData data service adapter &amp; set as the default</span>
    <span class="nx">breeze</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">initializeAdapterInstance</span><span class="p">(</span><span class="s1">'dataService'</span><span class="p">,</span> <span class="s1">'webApiOData'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="c1">// init entity manager</span>
    <span class="nx">initEntityManager</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ensure antiforgery token included in all HTTP requests</span>
        <span class="nx">configureDetaultHttpClient</span><span class="p">();</span>
        <span class="c1">// fixup the metadata processing of the response</span>
        <span class="nx">fixupMetadataProcessing</span><span class="p">();</span>
      <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// create breeze data service w/ endpoint to the WebAPIOdata service</span>
  <span class="kd">function</span> <span class="nx">getDataService</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// set the data service endpoint</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">breeze</span><span class="p">.</span><span class="nx">DataService</span><span class="p">({</span>
      <span class="nx">serviceName</span><span class="o">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">+</span> <span class="s1">'//'</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="s1">'/odata/'</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// initialize breeze entity manager</span>
  <span class="kd">function</span> <span class="nx">initEntityManager</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="c1">// if entity manager hasn't been initialized, do it now</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">entityManager</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// metadataStore must be populated before adding validators, so manually fetch metadata</span>
      <span class="nx">entityManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">breeze</span><span class="p">.</span><span class="nx">EntityManager</span><span class="p">(</span><span class="nx">getDataService</span><span class="p">());</span>
      <span class="c1">// ^^^ normally this happens on the first query, but if someone jumps straight to</span>
      <span class="c1">//  a deep link to create something (ie: #/projects/new), no query will happen</span>
      <span class="c1">//  and therefore none of the validators will be created</span>
      <span class="nx">entityManager</span><span class="p">.</span><span class="nx">fetchMetadata</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">configEntityIdentity</span><span class="p">();</span>
          <span class="nx">attachValidatorsToBreezeEntities</span><span class="p">();</span>
          <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">exception</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// configure the default HTTP client to include the antiforgery token in all requests</span>
  <span class="kd">function</span> <span class="nx">configureDetaultHttpClient</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// breeze uses datajs for OData requests</span>
    <span class="c1">// get a copy of the default OData client datajs uses</span>
    <span class="kd">var</span> <span class="nx">unsecuredClient</span> <span class="o">=</span> <span class="nx">OData</span><span class="p">.</span><span class="nx">defaultHttpClient</span><span class="p">;</span>
    <span class="c1">// create a new 'secured' http client...</span>
    <span class="kd">var</span> <span class="nx">securedClient</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">request</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// that adds the verification token to it</span>
        <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">RequestVerificationToken</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="s2">"#__RequestVerificationToken"</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">unsecuredClient</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="c1">// configure datajs to use the new secured client</span>
    <span class="nx">OData</span><span class="p">.</span><span class="nx">defaultHttpClient</span> <span class="o">=</span> <span class="nx">securedClient</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// configure the settings for the ID field as an identity</span>
  <span class="kd">function</span> <span class="nx">configEntityIdentity</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// set the project entity ID settings</span>
    <span class="kd">var</span> <span class="nx">projectType</span> <span class="o">=</span> <span class="nx">entityManager</span><span class="p">.</span><span class="nx">metadataStore</span><span class="p">.</span><span class="nx">getEntityType</span><span class="p">(</span><span class="s1">'Project'</span><span class="p">);</span>
    <span class="nx">projectType</span><span class="p">.</span><span class="nx">autoGeneratedKeyType</span> <span class="o">=</span> <span class="nx">breeze</span><span class="p">.</span><span class="nx">AutoGeneratedKeyType</span><span class="p">.</span><span class="nx">Identity</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// add custom client-side validators to the breeze entities</span>
  <span class="kd">function</span> <span class="nx">attachValidatorsToBreezeEntities</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// project entity</span>
    <span class="c1">//  title = required field </span>
    <span class="nx">entityManager</span><span class="p">.</span><span class="nx">metadataStore</span><span class="p">.</span><span class="nx">getEntityType</span><span class="p">(</span><span class="s1">'Project'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">getProperty</span><span class="p">(</span><span class="s1">'Title'</span><span class="p">).</span><span class="nx">validators</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">breeze</span><span class="p">.</span><span class="nx">Validator</span><span class="p">.</span><span class="nx">required</span><span class="p">());</span>
  <span class="p">}</span>
  <span class="c1">// fixes the metadata response to ensure that the etag is treated as real metadata</span>
  <span class="kd">function</span> <span class="nx">fixupMetadataProcessing</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// get reference to the base 'visitNode' method</span>
    <span class="kd">var</span> <span class="nx">adapter</span> <span class="o">=</span> <span class="nx">breeze</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">getAdapter</span><span class="p">(</span><span class="s1">'dataService'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">visitNodeBase</span> <span class="o">=</span> <span class="nx">adapter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">jsonResultsAdapter</span><span class="p">.</span><span class="nx">visitNode</span><span class="p">;</span>
    <span class="c1">// create a new 'visitNode' method that looks for the etag as a property on the entity</span>
    <span class="c1">//  if it isn't present in the metadata      </span>
    <span class="nx">adapter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">jsonResultsAdapter</span><span class="p">.</span><span class="nx">visitNode</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">mappingContext</span><span class="p">,</span> <span class="nx">nodeContext</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">metadata</span> <span class="o">=</span> <span class="nx">node</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">__metadata</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">metadata</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">etag</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">__eTag</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">metadata</span><span class="p">.</span><span class="nx">etag</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">__eTag</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">//  .. then call the base 'visitNode'</span>
      <span class="k">return</span> <span class="nx">visitNodeBase</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">mappingContext</span><span class="p">,</span> <span class="nx">nodeContext</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Save your changes and close the <strong>App\config.breeze.js</strong> file.</p>
</li>
<li>
<p>The Breeze library, when used with Angular, relies on the Angular $http service for it's AJAX calls to the server. To configure all calls to use the SharePoint JSON format response, configure the Angular $http service. </p>

<p>Open the <strong>App\config.angular.js</strong> file.</p>
</li>
<li>
<p>Add the following code to the body of the JavaScript self-executing function:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// define service</span>
<span class="kd">var</span> <span class="nx">serviceId</span> <span class="o">=</span> <span class="s1">'angular.config'</span><span class="p">;</span>
<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">).</span><span class="nx">factory</span><span class="p">(</span><span class="nx">serviceId</span><span class="p">,</span>
  <span class="p">[</span><span class="s1">'$http'</span><span class="p">,</span> <span class="nx">configAngular</span><span class="p">])</span>         
<span class="c1">// create service</span>
<span class="kd">function</span> <span class="nx">configAngular</span><span class="p">(</span><span class="nx">$http</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// init factory</span>
  <span class="nx">init</span><span class="p">()</span>            
  <span class="c1">// service public signature</span>
  <span class="k">return</span> <span class="p">{}</span>         
  <span class="c1">// init factory</span>
  <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// set common $http request headers</span>
    <span class="nx">$http</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">common</span><span class="p">.</span><span class="nx">Accept</span> <span class="o">=</span> <span class="s1">'application/json;odata=verbose;'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Save your changes and close the <strong>App\config.angular.js</strong> file.</p>
</li>
</ol>
</li>
<li>
<p>With the core SPA created, now configure it:</p>

<ol>
<li>Open the <strong>App\config.js</strong> file.</li>
<li>
<p>Add the following code to the body of the JavaScript self-executing function:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// get a reference to the app module</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">);</span>

<span class="c1">// collection of events used throughout the app</span>
<span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// event when the controller has been successfully activated</span>
    <span class="nx">controllerActivateSuccess</span><span class="o">:</span> <span class="s1">'controller.activateSuccess'</span><span class="p">,</span>
<span class="p">};</span>

<span class="c1">// create global static config object</span>
<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s1">'Project Research Tracker App'</span><span class="p">,</span>
    <span class="nx">events</span><span class="o">:</span> <span class="nx">events</span>
<span class="p">};</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="s1">'config'</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>

<span class="c1">// setup the angular logging provider to debug=on</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">config</span><span class="p">([</span><span class="s1">'$logProvider'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$logProvider</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$logProvider</span><span class="p">.</span><span class="nx">debugEnabled</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$logProvider</span><span class="p">.</span><span class="nx">debugEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}]);</span>

<span class="c1">// configure the common configuration</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">config</span><span class="p">([</span><span class="s1">'commonConfigProvider'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">cfg</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// setup app events</span>
    <span class="nx">cfg</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">controllerActivateSuccessEvent</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">controllerActivateSuccess</span><span class="p">;</span>
<span class="p">}]);</span>
</pre></div>

<p>Save your changes and close the <strong>App\config.js</strong> file.</p>
</li>
<li>Now configure the SPA for all URL routes that are supported. Open the <strong>App\config.route.js</strong> file.</li>
<li>
<p>Add the following code to the body of the JavaScript self-executing function:</p>

<div class="highlight highlight-javascript"><pre>
<span class="c1">// get a reference to the app module</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">);</span>
<span class="c1">// put all routes into global constant</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">constant</span><span class="p">(</span><span class="s1">'routes'</span><span class="p">,</span> <span class="nx">getRoutes</span><span class="p">());</span>
<span class="c1">// config the routes &amp; their resolvers</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">config</span><span class="p">([</span><span class="s1">'$routeProvider'</span><span class="p">,</span> <span class="s1">'routes'</span><span class="p">,</span> <span class="nx">routeConfigurator</span><span class="p">]);</span>
<span class="kd">function</span> <span class="nx">routeConfigurator</span><span class="p">(</span><span class="nx">$routeProvider</span><span class="p">,</span> <span class="nx">routes</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// load all routes into the system</span>
  <span class="nx">routes</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">route</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$routeProvider</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="nx">route</span><span class="p">.</span><span class="nx">config</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="c1">// if a route isn't found, send to spa's 404</span>
  <span class="nx">$routeProvider</span><span class="p">.</span><span class="nx">otherwise</span><span class="p">({</span> <span class="nx">redirectTo</span><span class="o">:</span> <span class="s1">'/'</span> <span class="p">});</span>
<span class="p">}</span>
<span class="c1">// build routes</span>
<span class="kd">function</span> <span class="nx">getRoutes</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">'/'</span><span class="p">,</span>
      <span class="nx">config</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">'/App/dashboard/dashboard.html'</span><span class="p">,</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s1">'Dashboard'</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="c1">// projects</span>
    <span class="p">{</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">'/projects'</span><span class="p">,</span>
      <span class="nx">config</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">'/App/projects/list.html'</span><span class="p">,</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s1">'Projects'</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">'/projects/:projectId'</span><span class="p">,</span>
      <span class="nx">config</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">'/App/projects/detailView.html'</span><span class="p">,</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s1">'View an Existing Project'</span><span class="p">,</span>
        <span class="nx">templateMode</span><span class="o">:</span> <span class="s1">'view'</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Save your changes and close the <strong>App\config.route.js</strong> file.</p>
</li>
</ol>
</li>
<li>
<p>Now we need a core shell for our SPA where Angular will load the views.</p>

<ol>
<li>Open the <strong>Views\Home\SPA.cshtml</strong> file.</li>
<li>
<p>Locate the hidden input form control on the page and add the following <code>&lt;div&gt;</code> just above it. It contains an Angular <strong>include</strong> directive which will replace the <code>&lt;div&gt;</code> at runtime:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;div</span> <span class="na">data-ng-include=</span><span class="s">"'/App/layout/shell.html'"</span><span class="nt">&gt;&lt;/div&gt;</span>
</pre></div>

<p>Save your changes and close the <strong>Views\Home\SPA.cshtml</strong> file.</p>
</li>
<li><p>Now create the shell view. Open the <strong>App\layout\shell.html</strong> file. It already has all the HTML it needs, but it needs some Angular directives to be functional.</p></li>
<li>
<p>Locate the opening <code>&lt;div&gt;</code> and add the following Angular <strong>controller</strong> directive:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;div</span> <span class="na">data-ng-controller=</span><span class="s">"shell as vm"</span><span class="nt">&gt;</span>
</pre></div>
</li>
<li>
<p>Next, locate the <code>&lt;div id="splash-page"&gt;</code> and add the <strong>show</strong> Angular directive so we can conditionally show/hide the splash page:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"splash-page"</span> <span class="na">data-ng-show=</span><span class="s">"vm.showSplashPage"</span> <span class="na">class=</span><span class="s">"dissolve-animation"</span><span class="nt">&gt;</span>
</pre></div>
</li>
<li>
<p>Now implement the working animation message for the app. Locate the <code>&lt;div class="page-splash dissolve-animation"&gt;</code> and add the following <strong>show</strong> directive:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;div</span> <span class="na">data-ng-show=</span><span class="s">"vm.isBusy"</span> <span class="na">class=</span><span class="s">"page-splash dissolve-animation"</span><span class="nt">&gt;</span>
</pre></div>

<p>For the inner empty <code>&lt;div&gt;</code>, add the following to bind the <strong>busyMessage</strong> property from the controller to the view:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"page-splash-message page-splash-message-subtle"</span><span class="nt">&gt;</span>{{vm.busyMessage}}<span class="nt">&lt;/div&gt;</span>
</pre></div>
</li>
<li>
<p>Finally, update the main view container. Find the empty <code>&lt;div&gt;</code> after the <strong>main view container</strong> commend replace it with the following. When Angular finds the matching route, it will load the view in the <strong>view</strong> directive:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;div</span> <span class="err">data-ng-view</span> <span class="na">class=</span><span class="s">"shuffle-animation"</span><span class="nt">&gt;&lt;/div&gt;</span>
</pre></div>

<p>Save your changes and close the <strong>App\layout\shell.html</strong> file.</p>
</li>
<li>
<p>With the shell view complete, implement the controller. Open the <strong>App\layout\shell.js</strong> file and add the following JavaScript:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// define controller</span>
<span class="kd">var</span> <span class="nx">controllerId</span> <span class="o">=</span> <span class="s1">'shell'</span><span class="p">;</span>
<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">).</span><span class="nx">controller</span><span class="p">(</span><span class="nx">controllerId</span><span class="p">,</span>
  <span class="p">[</span><span class="s1">'$rootScope'</span><span class="p">,</span> <span class="s1">'$route'</span><span class="p">,</span> <span class="s1">'dataContextAngular'</span><span class="p">,</span> <span class="s1">'common'</span><span class="p">,</span> <span class="s1">'config'</span><span class="p">,</span> <span class="nx">shell</span><span class="p">]);</span>
<span class="c1">// create controller</span>
<span class="kd">function</span> <span class="nx">shell</span><span class="p">(</span><span class="nx">$rootScope</span><span class="p">,</span> <span class="nx">$route</span><span class="p">,</span> <span class="nx">dataContextAngular</span><span class="p">,</span> <span class="nx">common</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="c1">// Boolean property used to show/hide splash page</span>
  <span class="nx">vm</span><span class="p">.</span><span class="nx">showSplashPage</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="c1">// props to control the busy indicator</span>
  <span class="nx">vm</span><span class="p">.</span><span class="nx">isBusy</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="c1">// init controller</span>
  <span class="nx">init</span><span class="p">();</span>
  <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// wire handler to successful route changes to</span>
    <span class="c1">//  - update the page title (for bookmarking)</span>
    <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$on</span><span class="p">(</span><span class="s1">'$routeChangeSuccess'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">current</span><span class="p">,</span> <span class="nx">previous</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$route</span><span class="p">.</span><span class="nx">current</span> <span class="o">||</span> <span class="o">!</span><span class="nx">$route</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">pageTitle</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">pageTitle</span> <span class="o">=</span> <span class="s1">' &gt; '</span> <span class="o">+</span> <span class="nx">$route</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="c1">// activate this controller, then initialize the app (making</span>
    <span class="c1">//   sure the lists in the SharePoint site are present)</span>
    <span class="c1">//   then hide the splash page</span>
    <span class="nx">common</span><span class="p">.</span><span class="nx">activateController</span><span class="p">([</span><span class="nx">dataContextAngular</span><span class="p">.</span><span class="nx">initConfigurations</span><span class="p">()],</span> <span class="nx">controllerId</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// app ready, hide splash</span>
        <span class="nx">vm</span><span class="p">.</span><span class="nx">showSplashPage</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// if receiving an error page redirect to the NoAuth (401) view</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="o">==</span> <span class="mi">401</span><span class="p">)</span> <span class="p">{</span>
          <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">"/Home"</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="c1">// listen for the custom event when controllers are activated successfully</span>
    <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$on</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">controllerActivateSuccess</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">args</span> <span class="o">&amp;&amp;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">controllerId</span> <span class="o">&amp;&amp;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">controllerId</span> <span class="o">!=</span> <span class="s1">'shell'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">vm</span><span class="p">.</span><span class="nx">isBusy</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Save your changes and close the <strong>App\layout\shell.js</strong> file.</p>
</li>
</ol>
</li>
<li>
<p>At this point you can implement a few views to view a list of all projects, view the details of a project and then create a project.</p>

<ol>
<li>First create the screen that shows a list of all projects. Open the <strong>App\projects\list.html</strong>.</li>
<li>
<p>Locate the opening <code>&lt;div&gt;</code> and add the following <strong>controller</strong> directive to it:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;div</span> <span class="na">data-ng-controller=</span><span class="s">"projectList as vm"</span><span class="nt">&gt;</span>
</pre></div>
</li>
<li>
<p>Locate the first <code>&lt;button&gt;</code> and add the following <strong>click</strong> directive to it:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span> <span class="na">data-ng-click=</span><span class="s">"vm.goNewProject()"</span><span class="nt">&gt;</span>
</pre></div>
</li>
<li>
<p>Locate the second <code>&lt;button&gt;</code> and add the following <strong>click</strong> directive to it:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-default"</span> <span class="na">data-ng-click=</span><span class="s">"vm.goRefresh()"</span><span class="nt">&gt;</span>
</pre></div>
</li>
<li>
<p>Scroll to the bottom of the file and look for the comment <strong>project list</strong>. Update the table row &amp; cell to create a list of all projects and display their titles, but when someone clicks on the row, wire it up to an event handler on the controller:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;tbody&gt;</span>
  <span class="nt">&lt;tr</span> <span class="na">data-ng-repeat=</span><span class="s">"proj in vm.projects"</span> <span class="na">data-ng-click=</span><span class="s">"vm.goProjectDetail(proj)"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;td&gt;</span>{{proj.Title}}<span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/tbody&gt;</span>
</pre></div>
</li>
<li>
<p>Finally, find the empty `</p>
<div>' that will be used for the modal dialog and add the <strong>include</strong> controller to include a modal dialog view:

<div class="highlight highlight-xml"><pre><span class="nt">&lt;div</span> <span class="na">data-ng-include=</span><span class="s">"'/App/projects/detailEdit.html'"</span><span class="nt">&gt;&lt;/div&gt;</span>
</pre></div>

<p>Save your changes and close the <strong>App\projects\list.html</strong> file.</p>
</div>
</li>
<li>
<p>Now implement the controller. Open the <strong>App\projects\list.js</strong> file and add the following JavaScript to it:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// define controller</span>
<span class="kd">var</span> <span class="nx">controllerId</span> <span class="o">=</span> <span class="s1">'projectList'</span><span class="p">;</span>
<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">).</span><span class="nx">controller</span><span class="p">(</span><span class="nx">controllerId</span><span class="p">,</span>
  <span class="p">[</span><span class="s1">'$location'</span><span class="p">,</span> <span class="s1">'$timeout'</span><span class="p">,</span> <span class="s1">'$modal'</span><span class="p">,</span> <span class="s1">'dataContextBreeze'</span><span class="p">,</span> <span class="s1">'common'</span><span class="p">,</span> <span class="nx">projectList</span><span class="p">]);</span>
<span class="c1">// create controller</span>
<span class="kd">function</span> <span class="nx">projectList</span><span class="p">(</span><span class="nx">$location</span><span class="p">,</span> <span class="nx">$timeout</span><span class="p">,</span> <span class="nx">$modal</span><span class="p">,</span> <span class="nx">datacontext</span><span class="p">,</span> <span class="nx">common</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">vm</span><span class="p">.</span><span class="nx">goNewProject</span> <span class="o">=</span> <span class="nx">goNewProject</span><span class="p">;</span>
  <span class="nx">vm</span><span class="p">.</span><span class="nx">goRefresh</span> <span class="o">=</span> <span class="nx">goRefresh</span><span class="p">;</span>
  <span class="nx">vm</span><span class="p">.</span><span class="nx">goProjectDetail</span> <span class="o">=</span> <span class="nx">goProjectDetail</span><span class="p">;</span>
  <span class="c1">// init controller</span>
  <span class="nx">init</span><span class="p">();</span>
  <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">common</span><span class="p">.</span><span class="nx">activateController</span><span class="p">([</span><span class="nx">getAllProjects</span><span class="p">()],</span> <span class="nx">controllerId</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// retrieve all projects form the server</span>
  <span class="kd">function</span> <span class="nx">getAllProjects</span><span class="p">(</span><span class="nx">forceRefresh</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">datacontext</span><span class="p">.</span><span class="nx">getProjects</span><span class="p">(</span><span class="nx">forceRefresh</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">projects</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">"error obtaining data: "</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// refresh the project list</span>
  <span class="kd">function</span> <span class="nx">goRefresh</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// clear out the existing projects</span>
    <span class="nx">vm</span><span class="p">.</span><span class="nx">projects</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="c1">// force a refresh of all projects </span>
    <span class="k">return</span> <span class="nx">getAllProjects</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// redirects to the new project page</span>
  <span class="kd">function</span> <span class="nx">goNewProject</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">modal</span> <span class="o">=</span> <span class="nx">$modal</span><span class="p">.</span><span class="nx">open</span><span class="p">({</span>
      <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">'myProjectModalContent.html'</span><span class="p">,</span>
      <span class="nx">controller</span><span class="o">:</span> <span class="s1">'projectDetailEdit'</span><span class="p">,</span>
      <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">project</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">datacontext</span><span class="p">.</span><span class="nx">createProject</span><span class="p">();</span> <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="c1">// update the list of projects with the local cache</span>
    <span class="k">return</span> <span class="nx">modal</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">getAllProjects</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// navigate to the detail page</span>
  <span class="kd">function</span> <span class="nx">goProjectDetail</span><span class="p">(</span><span class="nx">project</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">project</span> <span class="o">&amp;&amp;</span> <span class="nx">project</span><span class="p">.</span><span class="nx">Id</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$location</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s1">'/projects/'</span> <span class="o">+</span> <span class="nx">project</span><span class="p">.</span><span class="nx">Id</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Save your changes and close the <strong>App\projects\list.js</strong> file.</p>
</li>
<li><p>Now implement the screen for creating a new, or editing an existing project. Open the <strong>App\projects\detailEdit.html</strong>.</p></li>
<li>
<p>Locate the <code>&lt;h2&gt;</code> and replace it with the following to create a dynamic page title:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;h2</span> <span class="na">data-ng-bind=</span><span class="s">"pageTitle"</span><span class="nt">&gt;&lt;/h2&gt;</span>
</pre></div>
</li>
<li>
<p>Next, locate the <code>&lt;input&gt;</code> element on the page and add the following Angular <strong>model</strong> directive to implement two-way data binding with a model property:</p>

<div class="highlight highlight-xml"><pre>data-ng-model="project.Title"
</pre></div>
</li>
<li>
<p>Finally, update the buttons to change their enabled/disabled state as well as their click handlers. Locate the <code>&lt;div class="modal-footer"&gt;</code> and replace it with the following:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-footer"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span>
          <span class="na">data-ng-disabled=</span><span class="s">"!entityIsDirty"</span>
          <span class="na">data-ng-click=</span><span class="s">"goSave()"</span><span class="nt">&gt;</span>save<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-default"</span>
          <span class="na">data-ng-click=</span><span class="s">"goCancel()"</span><span class="nt">&gt;</span>cancel<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-danger"</span>
          <span class="na">data-ng-show=</span><span class="s">"templateMode=='edit'"</span>
          <span class="na">data-ng-click=</span><span class="s">"goDelete()"</span><span class="nt">&gt;</span>delete<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p>Save your changes and close the <strong>App\projects\detailEdit.html</strong> file.</p>
</li>
<li>
<p>Now implement the controller. Open the <strong>App\projects\detailEdit.js</strong> file and add the following JavaScript to it:</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// define controller</span>
<span class="kd">var</span> <span class="nx">controllerId</span> <span class="o">=</span> <span class="s1">'projectDetailEdit'</span><span class="p">;</span>
<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">).</span><span class="nx">controller</span><span class="p">(</span><span class="nx">controllerId</span><span class="p">,</span>
  <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="s1">'$modalInstance'</span><span class="p">,</span> <span class="s1">'$location'</span><span class="p">,</span> <span class="s1">'dataContextBreeze'</span><span class="p">,</span> <span class="s1">'common'</span><span class="p">,</span> <span class="s1">'project'</span><span class="p">,</span> <span class="nx">projectDetailEdit</span><span class="p">]);</span>
<span class="c1">// create controller</span>
<span class="kd">function</span> <span class="nx">projectDetailEdit</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$modalInstance</span><span class="p">,</span> <span class="nx">$location</span><span class="p">,</span> <span class="nx">datacontext</span><span class="p">,</span> <span class="nx">common</span><span class="p">,</span> <span class="nx">project</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="nx">$scope</span><span class="p">;</span>
  <span class="nx">vm</span><span class="p">.</span><span class="nx">project</span> <span class="o">=</span> <span class="nx">project</span><span class="p">;</span>
  <span class="nx">vm</span><span class="p">.</span><span class="nx">goSave</span> <span class="o">=</span> <span class="nx">goSave</span><span class="p">;</span>
  <span class="nx">vm</span><span class="p">.</span><span class="nx">goCancel</span> <span class="o">=</span> <span class="nx">goCancel</span><span class="p">;</span>
  <span class="nx">vm</span><span class="p">.</span><span class="nx">goDelete</span> <span class="o">=</span> <span class="nx">goDelete</span><span class="p">;</span>
  <span class="c1">// init controller</span>
  <span class="nx">init</span><span class="p">();</span>
  <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">project</span> <span class="o">&amp;&amp;</span> <span class="o">+</span><span class="nx">project</span><span class="p">.</span><span class="nx">Id</span> <span class="o">&amp;&amp;</span> <span class="nx">project</span><span class="p">.</span><span class="nx">Id</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">vm</span><span class="p">.</span><span class="nx">pageTitle</span> <span class="o">=</span> <span class="s2">"Edit Project"</span><span class="p">;</span>
      <span class="nx">vm</span><span class="p">.</span><span class="nx">templateMode</span> <span class="o">=</span> <span class="s1">'edit'</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">vm</span><span class="p">.</span><span class="nx">pageTitle</span> <span class="o">=</span> <span class="s2">"Create New Project"</span><span class="p">;</span>
      <span class="nx">vm</span><span class="p">.</span><span class="nx">templateMode</span> <span class="o">=</span> <span class="s1">'new'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// wire dirty checker</span>
    <span class="nx">wireUpEntityChangedHandler</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">project</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// listen for changes to fields in the entity</span>
  <span class="c1">//  and update flag to enable/disable save button</span>
  <span class="kd">function</span> <span class="nx">wireUpEntityChangedHandler</span><span class="p">(</span><span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">vm</span><span class="p">.</span><span class="nx">entityIsDirty</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="c1">// when a property changes on the entity</span>
    <span class="nx">entity</span><span class="p">.</span><span class="nx">entityAspect</span><span class="p">.</span><span class="nx">propertyChanged</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
      <span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// if the title property changed, update flag</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">propertyName</span> <span class="o">==</span> <span class="s1">'Title'</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">vm</span><span class="p">.</span><span class="nx">entityIsDirty</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// save the item</span>
  <span class="kd">function</span> <span class="nx">goSave</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">datacontext</span><span class="p">.</span><span class="nx">saveChanges</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">$modalInstance</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">project</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// reset the changes</span>
  <span class="kd">function</span> <span class="nx">goCancel</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// cancel any changes to the item</span>
    <span class="nx">datacontext</span><span class="p">.</span><span class="nx">revertChanges</span><span class="p">();</span>
    <span class="c1">// close the modal dialog</span>
    <span class="nx">$modalInstance</span><span class="p">.</span><span class="nx">dismiss</span><span class="p">(</span><span class="s1">'cancel'</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// delete entities</span>
  <span class="kd">function</span> <span class="nx">goDelete</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// get all references</span>
    <span class="k">return</span> <span class="nx">datacontext</span><span class="p">.</span><span class="nx">getProjectReferences</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">project</span><span class="p">.</span><span class="nx">Id</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">references</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// loop through all references...</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">references</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// set each to deleted, but supress the save call to the </span>
          <span class="c1">//  service... let the deletion of the project that will</span>
          <span class="c1">//  follow be the one that issues the batch delete</span>
          <span class="nx">datacontext</span><span class="p">.</span><span class="nx">deleteEntity</span><span class="p">(</span><span class="nx">references</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">datacontext</span><span class="p">.</span><span class="nx">deleteEntity</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">project</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="c1">// close the dialog &amp; navigate back to the project list page</span>
            <span class="nx">$modalInstance</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span>
              <span class="nx">$location</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s1">'/projects/'</span><span class="p">)</span>
              <span class="p">);</span>
          <span class="p">});</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Save your changes and close the <strong>App\projects\detailEdit.js</strong> file.</p>
</li>



<p>In this task you added code to existing JavaScript and HTML files to implement the single page application (SPA).</p>

<h3 id="task-4---test-the-application">
<a name="user-content-task-4---test-the-application" class="anchor" href="#task-4---test-the-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 4 - Test the Application</h3>

<p>Follow these steps to test the application.</p>

<ol>
<li>bla bla bla</li>
</ol>
<p>Now you have completed testing the application.</p>

<h2 id="summary">
<a name="user-content-summary" class="anchor" href="#summary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Summary</h2>

<p>By completing this hands-on lab you learnt how to:</p>

</ol>
<ul>
<li>Learn to configure Microsoft Azure AD for an Office 365 app</li>
<li>Understand how and why you need to secure an OAuth access token</li>
<li>Create a single page app</li>
</ul>
</li>
</ol></article></body></html>